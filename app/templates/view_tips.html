<!-- templates/view_tips.html -->
{% extends "base.html" %}

{% block content %}
<div class="container mt-4">
  <h2 class="mb-4">All Users' Tips - Round {{ selected_round }}</h2>

  <form method="get" action="{{ url_for('tip.view_tips') }}" class="mb-4">
    <label for="round" class="form-label">Select Round</label>
    <div class="input-group" style="max-width: 300px;">
      <select class="form-select" name="round" id="round" onchange="this.form.submit()">
        {% for round in all_rounds %}
          <option value="{{ round }}" {% if round == selected_round %}selected{% endif %}>Round {{ round }}</option>
        {% endfor %}
      </select>
    </div>
  </form>

  <div class="table-responsive">
    <table class="table table-bordered text-white">
        <thead class="table-light text-dark">
          <tr>
            <th>User</th>
            <th>Tips Submitted</th>
            <th>Match Details</th>
            <th>Match Results</th>
            <th>Tip Results</th>
          </tr>
        </thead>
        <tbody>
          <!-- Show current_user first -->
          <tr class="table-success">
            <td><strong>{{ current_user.username }} (You)</strong></td>
            <td>
              {% if tips_by_user[current_user.id] %}
                {% for tip in tips_by_user[current_user.id] %}
                  Match {{ tip.match }} → {{ tip.selected_team }}<br>
                {% endfor %}
              {% else %}
                No tips submitted.
              {% endif %}
            </td>
            <td>
                {% for fixture in fixtures %}
                    {{ fixture.home_team }}: {{ fixture.home_score }} vs. {{ fixture.away_team }}: {{ fixture.away_score }}<br>
                {% endfor %}
            </td>
                
          </tr>
      
          <!-- Then show all other users -->
          {% for user in users %}
            {% if user.id != current_user.id %}
            <tr>
              <td>{{ user.username }}</td>
              <td>
                {% if tips_by_user[user.id] %}
                  {% for tip in tips_by_user[user.id] %}
                    Match {{ tip.match }} → {{ tip.selected_team }}<br>
                  {% endfor %}
                {% else %}
                  No tips submitted.
                {% endif %}
              </td>
              <td>
                {% for fixture in fixtures %}
                    {{ fixture.home_team }}: {{ fixture.home_score }} vs. {{ fixture.away_team }}: {{ fixture.away_score }}<br>
                {% endfor %}
              </td>
              
            </tr>
            {% endif %}
          {% endfor %}
        </tbody>
    </table>
      
  </div>
</div>
{% endblock %}
